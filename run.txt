//// Docker file
docker network create chord-network

docker run --name bootstrap --network chord-network --env-file .env -p 8000:8000 --rm chordify python bootstrap.py

curl -X POST http://127.0.0.1:8001/insert -H "Content-Type: application/json" -d '{"key": "song1", "value": "node8001"}'

curl -X GET "http://127.0.0.1:8001/query?key=song1"

//// On Windows, instead of -X POST, GET

Invoke-WebRequest -Uri "http://127.0.0.1:8001/insert" `
  -Method Post `
  -Headers @{ "Content-Type" = "application/json" } `
  -Body '{"key": "song1", "value": "Imagine"}'

Invoke-WebRequest -Uri "http://127.0.0.1:8001/query/song1" -Method Get

Invoke-WebRequest -Uri "http://127.0.0.1:8001/delete" `
  -Method Post `
  -Headers @{ "Content-Type" = "application/json" } `
  -Body '{"key": "song1"}'

(Invoke-WebRequest -Uri "http://127.0.0.1:8001/overlay" -Method GET).Content

Invoke-WebRequest -Uri http://localhost:8001/depart -Method POST


///// Docker compose yml
sudo docker-compose build
sudo docker-compose up
    (Debugger on -> Οταν αλλαζεις κατι απλα κλεινεις και ξανακανεις up)

// New node
sudo docker run -d \
    --network chordify_default \
    --name node5 \
    -v $(pwd):/app \
    -e IP=node5 \
    -e PORT=8005 \
    -p 8005:8005 \
    chordify \
    python app.py --ip node5 --port 8005 --bootstrap_ip bootstrap --bootstrap_port 8000

sudo docker run -d \
    --network chordify_default \
    --name node6 \
    -v $(pwd):/app \
    -e IP=node6 \
    -e PORT=8006 \
    -p 8006:8006 \
    chordify \
    python app.py --ip node6 --port 8006 --bootstrap_ip bootstrap --bootstrap_port 8000


// get network
curl -X GET http://127.0.0.1:8001/overlay

curl -X POST http://localhost:8002/depart

 - Extra join δεν εχω βρει πως να κανεις αλλα δεν νομιζω οτι χρειαζεται κιολας
 - Δηλαδή σίγουρα καλο ειναι να ξερεις πως γίνεται, αλλά για αυτή την στιγμή είμαστε καλα
 - Μαλλον με καποιο docker run ---name node5 κατι τετοιο

 //queries
 Invoke-WebRequest -Uri "http://127.0.0.1:8001/query?key=song1" -Method Get
 $response = Invoke-WebRequest -Uri "http://127.0.0.1:8001/query?key=song1"
  $response.Content | ConvertFrom-Json | ConvertTo-Json -Depth 10

//////////////
nodes
bootstrap
0

1420581437667931473358569046990045498294268739854 - song1

3
1153412323553608433409003516544375445689255214539

2
1094592468334682115993406799157015824791113659155

1060835990263383605338597466665306717774306438481 - song2

897157909036590648573699943635484619774617861767 - yolo

5
605907502187820619582591828504881381613563872501

560530314752634316420197739378665337808593011142 - manos

4
300958178807431293100459636149632972812029243419



6
219554627954620086306823540638194890711608052240

204098985406021757975430306748131464992338660059 - song3

1
171865491289448819003469989719053766790160449571



/// insert / query / delete
curl -X POST http://node3:8000/insert \
     -H "Content-Type: application/json" \
     -d '{"key": "Imagine"}'

Invoke-WebRequest -Uri "http://127.0.0.1:8000/delete" `
  -Method Post `
  -Headers @{ "Content-Type" = "application/json" } `
  -Body '{"key": "song1"}'


////////////////////////////////////////////////////////////////////////////////////////////////////////////
AWS

// At the end ALWAYS
git restore *

// Stop and remove all containers
sudo docker rm -f $(sudo docker ps -aq)

// Deploy Bootstrap and 1 Node in VM1:
git pull
cd chordify/scritps/
sudo chmod +x deploy_bootstrap.sh
sudo ./deploy_bootstrap.sh

// Deploy 2 Nodes in other VMs
git pull
cd chordify/scritps/
sudo chmod +x deploy_node.sh
sudo ./deploy_node.sh

// Run Expirements
python3 request_expirement.py --bootstrap_ip 10.0.62.44 --bootstrap_port 8000 --num_nodes 4

// Change Configurations (Also delete all songs)
curl -X POST -H "Content-Type: application/json" -d '{"replication_factor": 3, "consistency_mode": "linearizability"}' http://10.0.62.44:8000/update_settings

// Nodes
44:8000
0

4:8001
100327599628895595809874772797002322028919969014

44:8001
295932134150687556341207193662481870356174536331

4:8002
1376187645279844781901574523592213044469256684617